<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Level Test - Unolingo</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
</head>
<body class="sidebar-layout">
  <div class="sidebar">
    <div class="logo">Unolingo</div>
    <a href="index.html" class="nav-button">üè† Home</a>
    <a href="quizzes.html" class="nav-button">‚ùì Quizzes</a>
    <a href="level-test.html" class="nav-button">‚ôú Test your level</a>
    <a href="videos.html" class="nav-button">üé• Videos</a>
    <a href="books.html" class="nav-button">üìñ Books</a>
    <a href="profile.html" class="nav-button">‚öîÔ∏è Profile</a>
    <a href="settings.html" class="nav-button">ü™∂ Settings</a>
  </div>
  
  <main class="container">
    <h2>Level Test</h2>
    <div id="question-box" class="question-box"></div>
    <div class="button-container">
      <button class="test-button" data-action="previous" id="prev-button">Previous</button>
      <button class="test-button" data-action="next" id="next-button">Next</button>
    </div>
  </main>

  <script src="app.js"></script>
  <script>
    // Level Test Questions - Comprehensive English Level Assessment
    const levelTestQuestions = [
      {
        text: "Choose the correct form: 'I _____ English for five years.'",
        options: ["have been studying", "am studying", "studied", "will study"],
        answer: 0,
        level: "Intermediate"
      },
      {
        text: "What is the past participle of 'break'?",
        options: ["broke", "broken", "breaked", "breaking"],
        answer: 1,
        level: "Elementary"
      },
      {
        text: "Which sentence is grammatically correct?",
        options: [
          "If I would have known, I would have come.",
          "If I had known, I would have come.",
          "If I know, I will come.",
          "If I knew, I would come."
        ],
        answer: 1,
        level: "Advanced"
      },
      {
        text: "Choose the correct preposition: 'She is good _____ mathematics.'",
        options: ["at", "in", "on", "for"],
        answer: 0,
        level: "Elementary"
      },
      {
        text: "What does 'procrastinate' mean?",
        options: ["To delay or postpone", "To hurry up", "To celebrate", "To organize"],
        answer: 0,
        level: "Advanced"
      },
      {
        text: "Which is the correct passive voice: 'Someone stole my car.'",
        options: [
          "My car was stolen by someone.",
          "My car is stolen by someone.",
          "My car has been stolen by someone.",
          "My car will be stolen by someone."
        ],
        answer: 0,
        level: "Intermediate"
      },
      {
        text: "Choose the correct conditional: 'If it _____ tomorrow, we will cancel the picnic.'",
        options: ["rains", "will rain", "would rain", "is raining"],
        answer: 0,
        level: "Intermediate"
      },
      {
        text: "What is the meaning of 'ubiquitous'?",
        options: ["Rare", "Present everywhere", "Expensive", "Difficult"],
        answer: 1,
        level: "Advanced"
      },
      {
        text: "Choose the correct article: 'I need _____ umbrella because it's raining.'",
        options: ["a", "an", "the", "no article"],
        answer: 1,
        level: "Elementary"
      },
      {
        text: "Which sentence uses the subjunctive mood correctly?",
        options: [
          "I suggest that he goes to the doctor.",
          "I suggest that he go to the doctor.",
          "I suggest that he went to the doctor.",
          "I suggest that he will go to the doctor."
        ],
        answer: 1,
        level: "Advanced"
      }
    ];

    let currentQuestionIndex = 0;
    let userAnswers = [];
    let startTime = Date.now();

    function renderQuestion() {
      const question = levelTestQuestions[currentQuestionIndex];
      let html = `
        <div class="question-header">
          <p><b>Question ${currentQuestionIndex + 1} of ${levelTestQuestions.length}</b></p>
          <p><b>Level:</b> ${question.level}</p>
        </div>
        <p class="question-text">${question.text}</p>
      `;
      
      question.options.forEach((option, i) => {
        const checked = userAnswers[currentQuestionIndex] === i ? "checked" : "";
        html += `
          <label class="option-label">
            <input type="radio" name="q${currentQuestionIndex}" value="${i}" ${checked}
              onchange="selectAnswer(${i})">
            <span class="option-text">${option}</span>
          </label>
        `;
      });
      
      document.getElementById("question-box").innerHTML = html;

      // Update button states
      document.getElementById("prev-button").disabled = currentQuestionIndex === 0;
      document.getElementById("next-button").textContent = 
        currentQuestionIndex === levelTestQuestions.length - 1 ? "Submit Test" : "Next Question";
    }

    function selectAnswer(answerIndex) {
      userAnswers[currentQuestionIndex] = answerIndex;
    }

    function nextQuestion() {
      if (currentQuestionIndex < levelTestQuestions.length - 1) {
        currentQuestionIndex++;
        renderQuestion();
      } else {
        submitTest();
      }
    }

    function previousQuestion() {
      if (currentQuestionIndex > 0) {
        currentQuestionIndex--;
        renderQuestion();
      }
    }

    function submitTest() {
      const endTime = Date.now();
      const timeSpent = Math.round((endTime - startTime) / 1000); // in seconds
      
      const results = calculateLevelTestResults();
      results.timeSpent = timeSpent;
      
      // Store results in localStorage
      storeLevelTestResults(results);
      
      // Redirect to results page
      window.location.href = "level-result.html";
    }

    function calculateLevelTestResults() {
      let correctAnswers = 0;
      let levelScores = {
        "Elementary": 0,
        "Intermediate": 0,
        "Advanced": 0
      };
      
      levelTestQuestions.forEach((question, index) => {
        if (userAnswers[index] === question.answer) {
          correctAnswers++;
          levelScores[question.level]++;
        }
      });
      
      const totalQuestions = levelTestQuestions.length;
      const percentage = Math.round((correctAnswers / totalQuestions) * 100);
      
      // Determine overall level based on performance
      let overallLevel = "Beginner";
      if (percentage >= 80) {
        overallLevel = "Advanced";
      } else if (percentage >= 60) {
        overallLevel = "Intermediate";
      } else if (percentage >= 40) {
        overallLevel = "Elementary";
      }
      
      return {
        totalQuestions,
        correctAnswers,
        percentage,
        overallLevel,
        levelScores,
        answers: userAnswers
      };
    }

    // Event handlers for test buttons
    addEventListeners('[data-action="previous"]', 'Previous button', previousQuestion);
    addEventListeners('[data-action="next"]', 'Next button', nextQuestion);

    // Initialize the test
    renderQuestion();
  </script>
</body>
</html>